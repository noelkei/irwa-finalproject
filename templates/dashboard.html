{% extends "base.html" %}
{% block page_title %}{{ page_title }}{% endblock %}
{% block header %}
    <!-- Load Chart.js for browser usage chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.2/chart.min.js"
            integrity="sha512-tMabqarPtykgDtdtSqCL3uLVM0gS1ZkUAVhRFu1vSEFgvB73niFQWJuvviDyBGBH22Lcau4rHB5p2K2T0Xvr6Q=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock %}
{% block content %}
    <h3>Dashboard</h3>
    <!-- Top visited products -->
    <h5>Top Visited Products:</h5>
    {% if visited_docs and visited_docs|length > 0 %}
    <ul>
        {% for doc in visited_docs[:5] %}
        <li><strong>{{ doc.counter }} views</strong> – {{ doc.description }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No products have been viewed yet.</p>
    {% endif %}
    <!-- Top search queries -->
    <h5>Top Search Queries:</h5>
    {% if top_queries and top_queries|length > 0 %}
    <ul>
        {% for query, count in top_queries %}
        <li>"{{ query }}" – {{ count }} searches</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No queries submitted yet.</p>
    {% endif %}
    <!-- Top query terms -->
    <h5>Top Query Terms:</h5>
    {% if top_terms and top_terms|length > 0 %}
    <ul>
        {% for term, count in top_terms %}
        <li>{{ term }} – {{ count }}</li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No significant query term data yet.</p>
    {% endif %}
    <!-- Browser usage chart -->
    <h5>Preferred Browsers:</h5>
    {% if browser_labels and browser_labels|length > 0 %}
    <canvas id="browserChart" width="400" height="300"></canvas>
    <script>
        const browserData = {
            labels: {{ browser_labels|tojson }},
            datasets: [{
                label: 'Browser Usage',
                data: {{ browser_counts|tojson }},
                backgroundColor: [
                    '#FF6384', '#36A2EB', '#FFCE56', '#8AFFC1', '#C9CBFF', '#FFB1C1'
                ]
            }]
        };
        const config = {
            type: 'pie',
            data: browserData,
            options: { plugins: { legend: { position: 'bottom' } } }
        };
        new Chart(document.getElementById('browserChart'), config);
    </script>
    {% else %}
    <p>No browser data available.</p>
    {% endif %}
    <hr>
    <!-- Embedded chart for document views -->
    <h5>Document Views Chart:</h5>
    <iframe src="/plot_number_of_views" width="600" height="400" style="border:none;"></iframe>
{% endblock %}
